<?php include "../../config/database.php";

$category = mysqli_query($con,"SELECT * FROM `GVWA`.`categories` ORDER BY `categories`.`name` ASC");
$category = mysqli_fetch_all($category);

// Is PHP function magic_quotee enabled?
$WarningHtml = '';
if( ini_get( 'magic_quotes_gpc' ) == true ) {
	$WarningHtml .= "<div class=\"warning\">The PHP function \"<em>Magic Quotes</em>\" is enabled.</div>";
}
// Is PHP function safe_mode enabled?
if( ini_get( 'safe_mode' ) == true ) {
	$WarningHtml .= "<div class=\"warning\">The PHP function \"<em>Safe mode</em>\" is enabled.</div>";
}
?>

<html>
<body>
<form action="#" method="GET">
<div class="search-box">
    <select id="category" name="category" multiple="multiple">
        <option value="all" selected="selected">All Categories</option>
        <?php
            if (! empty($category)) {
                 foreach ($category as $key => $value) { 
                    echo '<option value="' . implode($category[$key]) . '">' . implode($category[$key]) . '</option>';
                 }
             }
        ?>
    </select>
</div>
    <input type="text" name="query" />
	<input type="submit" value="Search" name="submit" />
    
</form>


    <?php include "../../config/database.php";

if( isset( $_REQUEST[ 'submit' ] ) ) {
	// Get input
    $category = $_REQUEST[ 'category' ];
    $query = $_REQUEST[ 'query' ];
    echo $category;

    // Check database
    if ($category != "all") {
        $raw_query =  "SELECT name,price FROM GVWA.items 
        WHERE  ((`name` = '$query') OR (`name` LIKE '%".$query."%') OR (`description` LIKE '%".$query."%')) AND `category` = '$category'";
    } else {
        $raw_query = "SELECT name,price FROM GVWA.items
            WHERE (`name` LIKE '%".$query."%') OR (`description` LIKE '%".$query."%');";
    }
    $raw_results = mysqli_query($con,  $raw_query ) or die( '<pre>' . ((is_object($con)) ? mysqli_error($con) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '</pre>' );

	// Get results
	while( $row = mysqli_fetch_assoc( $raw_results ) ) {
		// Get values
		$first = $row["name"];
		$last  = $row["price"];

		// Feedback for end user
        echo "<pre><br /><a href = ./product.php?name=$first>$first</a><br />Price: {$last}</pre>";
        //get links for each one
        //get comments working

        //maybe items for sellers only?
	}

	mysqli_close($con);
}

?>
</body>
</html>
