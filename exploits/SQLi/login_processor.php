<?php include '../../config/database.php';

/** 
 * // vuln type - login without password/username, username enumeration 
 * 
 * TODO:
 * Create a Git repo
 * display error on login page
 * admin login should only be suseptible to blind sql
 * get session related stuff 

*/
    $Username = $_POST['username'];
    $Password = $_POST['password'];

    $username_err = $password_err = "";

    //To prevent MySQL need to use this
    /** 
    $sql = "SELECT Username 
						  FROM Users
						  WHERE Password = :Password";
		$query = $db_connection->prepare($sql);
		$query->bindParam(':Password', $Password);
        $query->execute(); 

        $result = mysqli_query($con,"Select id from users where Username = '$Username' and Password = '$Password'") ;
    $row = mysqli_fetch_all($result);

    //allows username enumerations
    if ($row['Username']== $Username){
        $row = mysqli_fetch_array($result);
        if ($row['Password']== $Password){
            echo 'Login Success';
        }
        else{
            echo "Wrong Password";
        }
    }
    else{
        echo "Wrong Username";
    }
    */

    $result = mysqli_query($con,"Select username, password from users where Username = '$Username'") ;
    $row = mysqli_fetch_array($result);
 
    if (!$row) {
        echo '<p class="error">The username is wrong!</p>';
    } else {
        if ($Password == $row['password']) {
            //$_SESSION['user_id'] = $result['ID'];
            echo '<p class="success">Congratulations, you are logged in!</p>';
        } else {
            echo '<p class="error"> password is wrong!</p>';
        }
    }
?>
