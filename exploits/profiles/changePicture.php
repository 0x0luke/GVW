<?php

$WarningHtml = '';
if( !is_writable( $PHPUploadPath ) ) {
	$WarningHtml .= "<div class=\"warning\">Incorrect folder permissions: {$PHPUploadPath}<br /><em>Folder is not writable.</em></div>";
}
echo $WarningHtml;

echo $target_file;

if ($_FILES['image']['size'] > 0) {
    $check = getimagesize($_FILES["image"]["tmp_name"]);
    if ($check !== false) {
        $stmt = $con->prepare("Select name from `GVWA`.`items` where name = ?");
        $stmt->bind_param("s", $name);
        $stmt->execute();
        
        $res = $stmt->get_result();
        $product = $res->fetch_row();

        if (!$product == null) {
            echo "Item already exists";
            exit;
        }

        if ($check["mime"] != "image/png") {
            echo "must be a png file";
            exit;
        } else {
            if (move_uploaded_file($_FILES[ 'image' ][ 'tmp_name' ], $target_file)) {
                echo '<pre>Your image was uploaded.</pre>';
            }


            $stmt = $con->prepare("Select ID from `GVWA`.`sellers` where username = ?");
            //$id = mysqli_query($con, $sql) or die( '<pre>' . ((is_object($con)) ? mysqli_error($con) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '</pre>' );
            $stmt->bind_param("s", $seller);
            $stmt->execute();
            $res = $stmt->get_result();
            $seller = $res->fetch_row();

            $seller =  $seller[0];

            echo "File is an image - " . $check["mime"] . ".";
        
            $sql = "INSERT INTO `GVWA`.`items` (ID,category, name, price, description, sellerID, image) VALUES (null,'$category', '$name', '$price', '$description', '$seller','$target_file')";
            $id = mysqli_query($con, $sql) or die('<pre>' . ((is_object($con)) ? mysqli_error($con) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '</pre>');
            echo "Item uploaded successfully";
        }
    }
    } else {
        echo "File is not an image.";
    }

?>